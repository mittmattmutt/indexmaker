<!DOCTYPE html>

<head>
<title>indexmaker:editor</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
<script src="text.js"> </script>
<script src="index.js"> </script>

<style>

.col{
height:200px;
}

@font-face {
    font-family: myFirstFont;
    src:local("Literata-VariableFont_wght.ttf");
}

h1,h2,h3,h5,p, textarea, text {
font-family: myFirstFont;
}

</style>
</head>

<html>
<body>


<div class="container">


<div class="col align-self-center">
  <div class="row">
    <div class="col-3">

<div style="border-style: solid; border-color: mintcream;">


<label for="search_term_text">Enter a search term</label><br>
<input type="text" id="search_term_text"><p onclick="search()" style="color:blue; cursor:pointer;">Search</p>
<p onclick="dl()" id="download" style="color:blue; cursor:pointer;">Click here to download index with additions/subtractions in machine-readable-format</p>
<p onclick="dl_human()" id="download_human" style="color:blue; cursor:pointer;">Click here to download index with additions/subtractions in format suitable for humans.</p>

 <span style="font-size:40px;color:green; cursor:pointer;" onclick="backward()">&#x3c;</span> &nbsp&nbspNavigate the list       <span style="cursor:pointer; font-size:40px;color:green; float:right;" onclick="forward()">&#x3e;</span>
</div>

<div id="index_pane" style="border-style: solid; border-color: mintcream;">


</div>


</div>
	
	<div class="col-9"><h5 id="search_term">Search term &nbsp</h5><h6 id="add" onclick="add()" style="display:none; color:blue; cursor:pointer;">Add to index</h6><h6 id="text_pane1_title">Page number</h6>
<div class="col" id="text_pane1" style="overflow:scroll;border-style: solid; border-color: mintcream;">Text will appear here.</div>
	<h6 id="text_pane2_title">Page number</h6>
    <div class="col" style="overflow:scroll;border-style: solid; border-color: mintcream;" id="text_pane2" style="overflow:scroll;">Text will appear here.</div>
	<h6 id="text_pane3_title">Page number</h6>
    <div class="col" id="text_pane3" style="overflow:scroll;border-style: solid; border-color: mintcream;" style="border-style: solid; border-color: mintcream;>Text will appear here..</div>
    <div class="w-100"></div>
<span><span style="cursor:pointer; font-size:40px;color:green;" onclick="backward_pages()">&#x3c;</span><span="style="text-align:center;">Navigate Pages</span><span style="cursor:pointer; float: right;font-size:40px;color:green;" onclick="forward_pages()">&#x3e;</span></span>

<div class="col-9"><h3>About</h3>

<p>This is a tool to inspect and edit indexes created with the indexmaker python library: it lets you see multiple occurrences of a keyword at a time, and it lets you add and remove headings in what should be a pretty self-explanatory manner. The index itself is stored in index.js, which was generated by indexmaker. You can download a somewhat presentable version, which you can use to make the final index, by clicking the 'suitable for humans button above' (in each case, it's a misnomer to speak of 'downloading', because no files are coming from the web onto your machine. If you care about such things, this deals with input by putting the index in a .js file containing only the index variable, and output using <a href="https://stackoverflow.com/a/29376481">this</a> trick). If you make changes to it, and download the machine readable format, you should overwrite the existing index.js, and then, if you want or need, reopen this edit.html file. An important thing to note is that your changes are not saved if you refresh--so don't refresh (unless you want not to save your changes). Please let me know of mistakes, of which there definitely are some, and I will fix them.</p>

</div>

  </div>




</div>
</div>
</div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>



<script>

var loc=2;
var loc_pages=0;
var active_pages=[];
var removed=[];
var needssorted=1;
makeIndex(loc);
searchedarray=[];
var term;


function add()
{

for(x=0;x<index.length;x++)
{
if (index[x][0]<term && index[x+1][0]>term)
{
console.log(index[x][0]);
console.log(index[x+1][0]);
index.splice(x,0,[term,[term,active_pages]]);
console.log(index[x][0]);
console.log(index[x+1][0]);
console.log(index[x+2][0]);
break;
}
}

}



function search()
{
active_pages=[];
term=document.getElementById("search_term_text").value;
console.log(term);
document.getElementById("search_term_text").value="";
start=0;

for(x=0;x<text_file.length;x++)
{
while(text_file[x][1].indexOf(term, start)!=-1)
{
start=text_file[x][1].indexOf(term,start)+1;
active_pages.push(text_file[x][0]);
}
}
if(active_pages.length==0)
{
document.getElementById("search_term").innerHTML="No results for "+term;
return;
}
//console.log(searchedarray);
var a=active_pages;
a.unshift(term);

document.getElementById("add").setAttribute("style","display:block; color:blue; cursor:pointer;");
//active_pages.push(searchedarray);
console.log(a);
writepages(a);

}

function dl_human()
{
var text="";
for (x=0;x<index.length;x++)
{
text=text+index[x][0].toUpperCase();
text=text+"\n----------\n";
text=text+index[x][1][0];
text=text+"\n";

for(y=1;y<index[x][1].length;y++)
{
text=text+index[x][1][y]+",";}
//console.log(text);
text=text+'\n';
}
//console.log(text);
 //formerly new_array

var pom=document.createElement('a');
pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    pom.setAttribute('download', "indexreadable.txt");

pom.click();

}

function dl()
{


var string_array="var index="+JSON.stringify(index); //formerly new_array

var pom=document.createElement('a');
pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(string_array));
    pom.setAttribute('download', "index_.js");

pom.click();

}

function backward_pages()
{
var a=document.getElementById("search_term").innerHTML
document.getElementById("text_pane1").innerHTML="";
document.getElementById("text_pane2").innerHTML="";
document.getElementById("text_pane3").innerHTML="";
loc_pages=loc_pages-6;
writepages(a);

}

function forward_pages()
{
var a=document.getElementById("search_term").innerHTML
var new_a=a.split(",");
console.log(a);
document.getElementById("text_pane1").innerHTML="";
document.getElementById("text_pane2").innerHTML="";
document.getElementById("text_pane3").innerHTML="";
document.getElementById("text_pane1_title").innerHTML="";
document.getElementById("text_pane2_title").innerHTML="";
document.getElementById("text_pane3_title").innerHTML="";
//loc_pages=loc_pages+3;
writepages(new_a);

} 

function writepages(a)
{
var term=a[0];
var inde;
var found=0;
counter=1;

for (x=loc_pages;x<active_pages.length;x++)
{
var text=0;
var end_text=0
var mid_text=0
var new_text=0
//console.log(active_pages[1][1]);
panename="text_pane"+counter;
for(y=0;y<text_file.length;y++)
{


if(text_file[y][0]==active_pages[x] && counter<4){
console.log("i get here");
var start_scroll=0;
var scroll=0;
var toggle_first_position=0;
var location=0;
var indices=[];
var position=0;
var text=text_file[y][1];

//console.log(text);

var j=0;

while(text.indexOf(term, j)!=-1)
{
j=text.indexOf(term,j);
scroll=j;
new_text=text.slice(0,j);
mid_text='<span style="background-color:yellow;">'+term+'</span>';
end_text=text.slice(j+term.length,text.length);
complete_text=new_text+mid_text+end_text
text=complete_text;
j=j+mid_text.length+1;
}
scroll=scroll/3;
scroll=scroll-160;
document.getElementById(panename+"_title").innerHTML=active_pages[x];
document.getElementById(panename).innerHTML=text; //text_file[y][1]
document.getElementById(panename).scrollTo(scroll,scroll);
document.getElementById("search_term").innerHTML=a;
console.log("scroll");
console.log(scroll);
counter++;
loc_pages++;
}
}
}

}


function forward()
{
console.log("i get here"+loc);
loc=loc+2;
document.getElementById("index_pane").innerHTML="";
makeIndex(loc);
}

function backward()
{
loc=loc-2;
document.getElementById("index_pane").innerHTML="";
makeIndex(loc);
}


//var index=JSON.parse(textindex);
//var text_parsed=JSON.parse(text);

function makeIndex(l)
{
var testindex=[];

if(needssorted==1)
{
testindex=index;
console.log(testindex[15]);
testindex.sort(function(a,b){return a[0]-b[0]});
console.log(testindex[15]);
needssorted=0;
}


for (x=l;x<l+2;x++)
{
//console.log(x);
var t=document.createElement("h6");
t.innerHTML=index[x][0];
document.getElementById("index_pane").appendChild(t)

for(y=0;y<index[x][1].length;y++)
{
//console.log(y*100);
var list=document.createElement("ul");
var item=document.createElement("li");
var del=document.createElement("li");

item.innerHTML=index[x][1][y];
del.innerHTML="&#10060;";
var id=index[x][1][y].toString()
var id_delete=index[x][1][y].toString()+",delete";
item.setAttribute("id",id);
item.setAttribute("style", "cursor:pointer;overflow:auto;");
del.setAttribute("id",id_delete);
del.setAttribute("style", "cursor:pointer;list-style:none;");
list.appendChild(item);
list.appendChild(del);
document.getElementById("index_pane").appendChild(list);}

}
}

function del(e_rep)
{
document.getElementById(e_rep).remove();
var new_id=e_rep.replace(",delete","");
document.getElementById(new_id).remove();
var toberemoved=new_id.split(",")[0]
console.log(toberemoved);

for(x=0;x<index.length;x++)
{
//console.log(index[x][1]);
for (y=0;y<index[x][1].length;y++)
{
console.log(index[x][1][y][0]);
if(index[x][1][y][0]==toberemoved)
{
console.log("i get here");
index[x][1].splice(y,1);
break;
}
}

}
//console.log(index);
}

document.getElementById("index_pane").addEventListener("click", function(event){



var pane=1;

var paneid="text_pane1";

e=event.target.id;

var array=e.split(",");


if (array[array.length-1]=="delete")
{
del(e);
return;
}

document.getElementById("text_pane1").innerHTML="";
document.getElementById("text_pane2").innerHTML="";
document.getElementById("text_pane3").innerHTML="";
document.getElementById("text_pane1_title").innerHTML="";
document.getElementById("text_pane2_title").innerHTML="";
document.getElementById("text_pane3_title").innerHTML="";


active_pages=[];
for(x=1;x<array.length;x++)
{
active_pages.push(array[x]);
}
loc_pages=0;
console.log(active_pages);
writepages(array);

});





</script>






</body>

</html>


